'use strict';

const SVGO = require('svgo');
const xml2js = require('xml2js');

const { svgo: svgoConfig } = require('../lib/config');
const svgo = new SVGO(svgoConfig);

const mockReadFile = jest.fn(() =>
  Promise.resolve(`<?xml version="1.0" encoding="UTF-8"?>
    <svg width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <!-- Generator: Sketch 49 (51002) - http://www.bohemiancoding.com/sketch -->
      <title>icon/details/ic_ticket</title>
      <desc>Created with Sketch.</desc>
      <defs></defs>
      <g id="icon/details/ic_ticket" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
          <path d="M12.7133596,8.1066091 L5.10669052,8.1066091 L5.10669052,8.77328543 C6.3444699,9.50130871 6.9633596,10.571987 6.9633596,11.9853202 C6.9633596,13.3986535 6.3444699,14.5653202 5.10669052,15.4853202 L5.10669052,16.1065308 L12.7133596,16.1065308 L12.7133596,8.1066091 Z M14.7133596,8.1066091 L14.7133596,16.1065308 L19.1067267,16.1065308 L19.1066376,15.4399081 C18.0111189,14.5501828 17.4633596,13.3986535 17.4633596,11.9853202 C17.4633596,10.571987 18.0111189,9.50130871 19.1066376,8.77328543 L19.1067267,8.1066091 L14.7133596,8.1066091 Z M5.10666174,6.10659677 L19.1067297,6.10658128 C20.2112992,6.10658128 21.1067297,7.00201178 21.1067297,8.10658128 C21.1067297,8.10658644 21.1067297,8.1065916 21.1067297,8.10659677 L21.1066858,9.22617868 C21.1066823,9.68055991 20.8003329,10.0778187 20.3608742,10.1933104 C19.5247572,10.4130458 19.1066987,11.0508409 19.1066987,12.1066957 C19.1066987,13.1625511 19.5247576,13.8003463 20.3608754,14.0200813 C20.8003453,14.1355724 21.106702,14.5328405 21.1067056,14.9872323 L21.1067297,16.1067947 C21.1067383,17.2113642 20.2113147,18.1068016 19.1067452,18.1068102 C19.10674,18.1068102 19.1067349,18.1068102 19.1067297,18.1068102 L5.10666174,18.1068132 C4.00209224,18.1068132 3.10666174,17.2113827 3.10666174,16.1068132 C3.10666174,16.106807 3.10666174,16.1068009 3.10666174,16.1067947 L3.10670921,14.9872128 C3.10671341,14.5328314 3.41306327,14.1355728 3.85252218,14.0200813 C4.68863988,13.8003463 5.10669874,13.1625511 5.10669874,12.1066957 C5.10669874,11.0508403 4.68863984,10.4130451 3.85252204,10.1933101 C3.41305178,10.0778203 3.1066948,9.68055254 3.10669059,9.22616063 L3.10666174,8.10659677 C3.10665152,7.00202727 4.00207374,6.10658849 5.10664324,6.10657827 C5.10664941,6.10657827 5.10665557,6.10657827 5.10666174,6.10657827 L5.10666174,6.10659677 Z" id="ic_ticket" fill="#333333" transform="translate(12.106696, 12.106696) rotate(-45.000000) translate(-12.106696, -12.106696) "></path>
      </g>
    </svg>
  `)
);

jest.mock('fs-extra', () => {
  return {
    readFile: mockReadFile
  };
});

const getIconData = require('../lib/getIconData');

test('Get standard icon data', async () => {
  const iconData = await getIconData({
    fileName: 'ic_ticket.svg',
    id: 'ic_ticket'
  });
  expect(iconData).toEqual({
    fileName: 'ic_ticket.svg',
    icon: {
      svg: {
        $: {
          viewBox: '0 0 24 24',
          xmlns: 'http://www.w3.org/2000/svg'
        },
        g: [
          {
            $: {
              fill: 'none',
              'fill-rule': 'evenodd'
            },
            path: [
              {
                $: {
                  d:
                    'M12.7133596,8.1066091 L5.10669052,8.1066091 L5.10669052,8.77328543 C6.3444699,9.50130871 6.9633596,10.571987 6.9633596,11.9853202 C6.9633596,13.3986535 6.3444699,14.5653202 5.10669052,15.4853202 L5.10669052,16.1065308 L12.7133596,16.1065308 L12.7133596,8.1066091 Z M14.7133596,8.1066091 L14.7133596,16.1065308 L19.1067267,16.1065308 L19.1066376,15.4399081 C18.0111189,14.5501828 17.4633596,13.3986535 17.4633596,11.9853202 C17.4633596,10.571987 18.0111189,9.50130871 19.1066376,8.77328543 L19.1067267,8.1066091 L14.7133596,8.1066091 Z M5.10666174,6.10659677 L19.1067297,6.10658128 C20.2112992,6.10658128 21.1067297,7.00201178 21.1067297,8.10658128 C21.1067297,8.10658644 21.1067297,8.1065916 21.1067297,8.10659677 L21.1066858,9.22617868 C21.1066823,9.68055991 20.8003329,10.0778187 20.3608742,10.1933104 C19.5247572,10.4130458 19.1066987,11.0508409 19.1066987,12.1066957 C19.1066987,13.1625511 19.5247576,13.8003463 20.3608754,14.0200813 C20.8003453,14.1355724 21.106702,14.5328405 21.1067056,14.9872323 L21.1067297,16.1067947 C21.1067383,17.2113642 20.2113147,18.1068016 19.1067452,18.1068102 C19.10674,18.1068102 19.1067349,18.1068102 19.1067297,18.1068102 L5.10666174,18.1068132 C4.00209224,18.1068132 3.10666174,17.2113827 3.10666174,16.1068132 C3.10666174,16.106807 3.10666174,16.1068009 3.10666174,16.1067947 L3.10670921,14.9872128 C3.10671341,14.5328314 3.41306327,14.1355728 3.85252218,14.0200813 C4.68863988,13.8003463 5.10669874,13.1625511 5.10669874,12.1066957 C5.10669874,11.0508403 4.68863984,10.4130451 3.85252204,10.1933101 C3.41305178,10.0778203 3.1066948,9.68055254 3.10669059,9.22616063 L3.10666174,8.10659677 C3.10665152,7.00202727 4.00207374,6.10658849 5.10664324,6.10657827 C5.10664941,6.10657827 5.10665557,6.10657827 5.10666174,6.10657827 L5.10666174,6.10659677 Z',
                  fill: '#333',
                  transform:
                    'translate(12.106696, 12.106696) rotate(-45.000000) translate(-12.106696, -12.106696)'
                }
              }
            ]
          }
        ]
      }
    },
    id: 'ic_ticket',
    svgIds: []
  });
});

test('Get themeable icon data', async () => {
  const iconData = await getIconData(
    {
      fileName: 'ic_ticket.svg',
      id: 'ic_ticket'
    },
    true
  );
  expect(iconData).toEqual({
    fileName: 'ic_ticket.svg',
    icon: {
      svg: {
        $: {
          viewBox: '0 0 24 24',
          xmlns: 'http://www.w3.org/2000/svg'
        },
        g: [
          {
            $: {
              fill: 'none',
              'fill-rule': 'evenodd'
            },
            path: [
              {
                $: {
                  d:
                    'M12.7133596,8.1066091 L5.10669052,8.1066091 L5.10669052,8.77328543 C6.3444699,9.50130871 6.9633596,10.571987 6.9633596,11.9853202 C6.9633596,13.3986535 6.3444699,14.5653202 5.10669052,15.4853202 L5.10669052,16.1065308 L12.7133596,16.1065308 L12.7133596,8.1066091 Z M14.7133596,8.1066091 L14.7133596,16.1065308 L19.1067267,16.1065308 L19.1066376,15.4399081 C18.0111189,14.5501828 17.4633596,13.3986535 17.4633596,11.9853202 C17.4633596,10.571987 18.0111189,9.50130871 19.1066376,8.77328543 L19.1067267,8.1066091 L14.7133596,8.1066091 Z M5.10666174,6.10659677 L19.1067297,6.10658128 C20.2112992,6.10658128 21.1067297,7.00201178 21.1067297,8.10658128 C21.1067297,8.10658644 21.1067297,8.1065916 21.1067297,8.10659677 L21.1066858,9.22617868 C21.1066823,9.68055991 20.8003329,10.0778187 20.3608742,10.1933104 C19.5247572,10.4130458 19.1066987,11.0508409 19.1066987,12.1066957 C19.1066987,13.1625511 19.5247576,13.8003463 20.3608754,14.0200813 C20.8003453,14.1355724 21.106702,14.5328405 21.1067056,14.9872323 L21.1067297,16.1067947 C21.1067383,17.2113642 20.2113147,18.1068016 19.1067452,18.1068102 C19.10674,18.1068102 19.1067349,18.1068102 19.1067297,18.1068102 L5.10666174,18.1068132 C4.00209224,18.1068132 3.10666174,17.2113827 3.10666174,16.1068132 C3.10666174,16.106807 3.10666174,16.1068009 3.10666174,16.1067947 L3.10670921,14.9872128 C3.10671341,14.5328314 3.41306327,14.1355728 3.85252218,14.0200813 C4.68863988,13.8003463 5.10669874,13.1625511 5.10669874,12.1066957 C5.10669874,11.0508403 4.68863984,10.4130451 3.85252204,10.1933101 C3.41305178,10.0778203 3.1066948,9.68055254 3.10669059,9.22616063 L3.10666174,8.10659677 C3.10665152,7.00202727 4.00207374,6.10658849 5.10664324,6.10657827 C5.10664941,6.10657827 5.10665557,6.10657827 5.10666174,6.10657827 L5.10666174,6.10659677 Z',
                  fill: 'currentColor',
                  transform:
                    'translate(12.106696, 12.106696) rotate(-45.000000) translate(-12.106696, -12.106696)'
                }
              }
            ]
          }
        ]
      }
    },
    id: 'ic_ticket',
    svgIds: []
  });
});
